package fr.utbm.ia54.acotsp

/** 
 * 
 */

import gui.GUI
import io.sarl.core.DefaultContextInteractions
import io.sarl.core.Destroy
import io.sarl.core.Initialize
import io.sarl.core.Logging
import java.io.File
import java.util.ArrayList
import io.sarl.lang.core.Event

/** 
 * @author Omen
 * 
 */
agent GUIAgent {
	uses Logging, DefaultContextInteractions

	
	
	on Initialize {

		info("The agent was started.")


		var gtsp = new Gtsp(new File('data/instances/20kroA100.txt'))
		var pheromoneEvaporationFactor = 0.1f
		var pheromoneRegulationFactor = 1f
		var visibilityRegulationFactor = 1.25f
		var nunberOfAnts = 70
		var numberOfIterations = 100
		var frequencyOfMutation = 15
		var probabilityOfMutation = 0.15f
		var acoParameters = new ACOParameters(
			gtsp.dimension,
			gtsp.groupDimension,
			convertToFloatArrayList(gtsp.node_dist),
			convertToFloatArrayList(gtsp.node_coord_section),
			convertToIntegerArrayList(gtsp.group_list),
			pheromoneEvaporationFactor,
			pheromoneRegulationFactor,
			visibilityRegulationFactor,
			nunberOfAnts,
			numberOfIterations,
			frequencyOfMutation,
			probabilityOfMutation
		)
		emit(new NewOptimization(acoParameters))
	}

	on Destroy {
		// Event trigger when the agent is destroyed from the system.
		// You should put all the resource releasing statements in this block of code.
		info("The agent was stopped.")
	}

	@SuppressWarnings("discouraged_occurrence_readonly_use")
	on OptimizationFinished {
		
		
		emit(new GuiRepaint(occurrence.pheromones, occurrence.bestPath, occurrence.bestPathLength))
		
	}
		

	def convertToFloatArrayList(array : float[][]) : ArrayList<ArrayList<Float>> {
		var response = new ArrayList<ArrayList<Float>>
		for (var i = 0; i < array.length; i++) {
			var temp = new ArrayList<Float>
			for (var j = 0; j < array.get(i).length; j++) {
				temp.add(array.get(i).get(j))
			}
			response.add(temp)
		}
		return response
	}

	def convertToIntegerArrayList(array : int[]) : ArrayList<Integer> {
		var response = new ArrayList<Integer>
		for (var i = 0; i < array.length; i++) {
			response.add(array.get(i))
		}
		return response
	}


}
